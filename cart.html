<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Shrikhand&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="cart.css" />
  <title>Cart Items</title>
</head>
<body>

  <header>
    <div class="logo">
      <img src="/GouRoo®.png" alt="Company Logo">
      <p style="font-family: 'Shrikhand'; font-size: 40px;">GouRoo®</p>
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="products.html">Products</a></li>
        <li style="color: #ffcc00; font-weight: bold;">Cart</li>
        <li><a href="contactus.html">Contact Us</a></li>
      </ul>
    </nav>
  </header>

  <h1 id="ourpro">Your Cart</h1>
  <div class="products" id="cartContainer"></div>
  <div id="totalPrice"></div>

  <div class="checkout-form">
    <h2>Checkout</h2>
    <form id="orderForm" action="https://formspree.io/f/xnnvzozk" method="POST" enctype="multipart/form-data">
      <input type="text" name="name" id="name" placeholder="Full Name" required />
      <span class="error" id="nameError"></span>

      <input type="text" name="phone" id="phone" placeholder="Phone Number" required />
      <span class="error" id="phoneError"></span>

      <textarea name="address" id="address" rows="4" placeholder="Delivery Address" required></textarea>
      <span class="error" id="addressError"></span>

      <!-- Payment Method -->
      <div style="margin: 20px 0;">
        <label style="font-weight:bold;">Choose Payment Method:</label><br/>
        <input type="radio" name="paymentMethod" id="scanPay" value="scan" required />
        <label for="scanPay">Scan and Pay (Corrior charges +50 included)</label><br/>
        <input type="radio" name="paymentMethod" id="codPay" value="cod" />
        <label for="codPay">Cash on Delivery (COD) (Additional delivery partner charges +100 included)</label>
      </div>

      <!-- Hidden field for cart data -->
      <textarea name="cart_details" id="cartData" style="display:none;"></textarea>

      <!-- Scan and Pay Section -->
      <div id="scanSection" style="display: none;">
        <div style="margin: 20px 0;">
          <label style="font-weight:bold;">Scan &amp; Pay:</label>
          <div style="margin: 10px 0;">
            <img src="/qr.jpg" alt="QR Code for Payment" style="width:180px; border:1px solid #ccc; border-radius:10px;" />
          </div>
        </div>

        <div style="margin: 20px 0;">
          <label for="paymentScreenshot" style="font-weight:bold;">Upload Payment Screenshot:</label>
          <input type="file" id="paymentScreenshot" name="payment_screenshot" accept="image/*" style="display:block; margin:10px auto 0 auto;" />
          <span class="error" id="screenshotError"></span>
        </div>

        <label for="confirmPayment" style="font-weight:bold;">I confirm that I have paid the full amount.</label>
        <input type="radio" id="confirmPayment" name="confirmPaymentRadio" />
        <span class="error" id="confirmError"></span>
      </div>

      <input type="hidden" name="_next" value="/payment.html">
      <input type="hidden" name="_captcha" value="false">

      <button type="submit">Place Order</button>
    </form>
  </div>


  <script>
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    const container = document.getElementById("cartContainer");
    const totalPriceEl = document.getElementById("totalPrice");
    const cartDataInput = document.getElementById("cartData");

    function renderCart() {
      container.innerHTML = "";
      let total = 0;

      if (cart.length === 0) {
        container.innerHTML = "<p style='text-align:center;'>Your cart is empty.</p>";
        totalPriceEl.innerHTML = "";
        return;
      }

      const cartSummary = [];

      cart.forEach((item, index) => {
        const priceValue = parseInt(item.price.replace(/[^\d]/g, ""));
        total += priceValue * item.quantity;

        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
          <img src="${item.img}" alt="${item.name}" style="width:250px; height:250px; border-radius:10px;"/>
          <h1 style="font-family: 'Shrikhand'; font-size: 1.2em;">${item.name}</h1>
          <h4>${item.price}</h4>
          <div class="quantity-controls">
            <button onclick="decreaseQuantity(${index})">-</button>
            <span>Quantity: ${item.quantity}</span>
            <button onclick="increaseQuantity(${index})">+</button>
          </div>
          <button onclick="removeFromCart(${index})" style="background-color:red; color:white; padding:5px 10px; border:none; border-radius:5px;">Remove</button>
        `;
        container.appendChild(div);

        cartSummary.push(`${item.name} - Qty: ${item.quantity}`);
      });

      cartDataInput.value = cartSummary.join('\n');
      totalPriceEl.innerHTML = `Total: ₹${total}/-`;
    }

    function increaseQuantity(index) {
      cart[index].quantity += 1;
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    function decreaseQuantity(index) {
      if (cart[index].quantity > 1) {
        cart[index].quantity -= 1;
      } else {
        cart.splice(index, 1);
      }
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    document.getElementById("scanPay").addEventListener("change", function () {
      document.getElementById("scanSection").style.display = "block";
    });

    document.getElementById("codPay").addEventListener("change", function () {
      document.getElementById("scanSection").style.display = "none";
    });

    document.getElementById("orderForm").addEventListener("submit", function(e) {
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const address = document.getElementById("address").value.trim();

      let hasError = false;

      document.getElementById("nameError").textContent = "";
      document.getElementById("phoneError").textContent = "";
      document.getElementById("addressError").textContent = "";
      document.getElementById("screenshotError").textContent = "";
      document.getElementById("confirmError").textContent = "";

      if (name === "") {
        document.getElementById("nameError").textContent = "Name is required.";
        hasError = true;
      }

      if (!/^\d{10}$/.test(phone)) {
        document.getElementById("phoneError").textContent = "Enter a valid 10-digit phone number.";
        hasError = true;
      }

      if (address.length < 10) {
        document.getElementById("addressError").textContent = "Please enter a valid address.";
        hasError = true;
      }

      if (cart.length === 0) {
        alert("Your cart is empty. Please add products to proceed.");
        e.preventDefault();
        return;
      }

      const scanPay = document.getElementById("scanPay").checked;
      const codPay = document.getElementById("codPay").checked;

      if (!scanPay && !codPay) {
        alert("Please select a payment method.");
        e.preventDefault();
        return;
      }

      if (scanPay) {
        const screenshot = document.getElementById("paymentScreenshot").files[0];
        const confirmPayment = document.getElementById("confirmPayment").checked;

        if (!screenshot) {
          document.getElementById("screenshotError").textContent = "Please upload your payment screenshot.";
          hasError = true;
        } else if (!screenshot.type.startsWith("image/")) {
          document.getElementById("screenshotError").textContent = "Uploaded file must be an image.";
          hasError = true;
        } else if (screenshot.size > 5 * 1024 * 1024) {
          document.getElementById("screenshotError").textContent = "Image size must be less than 5MB.";
          hasError = true;
        }

        if (!confirmPayment) {
          document.getElementById("confirmError").textContent = "Please confirm that you've paid the full amount.";
          hasError = true;
        }
      }

      if (hasError) {
        e.preventDefault();
        return;
      }

      alert("Thank you! Your order has been placed.");
      localStorage.removeItem("cart");
    });

    renderCart();
  </script>

</body>
</html>
